# Отчет о написании прака по моделированию работы морского порта

## Постановка задачи

Написание моделирования работы морского порта для проведения экспериментов по оптимизации времени прибытия кораблей
для уменьшения штрафного времени (нарисовать кораблики)

## Диаграмма классов

### Frontend

```mermaid
graph BT;
	DrawableScheduleItem-->kat::Div;
	ShipInput-->kat::TextInput;
	kat::TextInput-->something_in_KatLib;
	something_in_KatLib-->kat::Div;
	kat::Image-->kat::Div;
	kat::ScrollArea-->kat::Div;
	kat::VerScrollArea-->kat::ScrollArea;
	ScheduleScroll-->kat::VerScrollArea;
	DrawableShip-->kat::Image;
```

```mermaid
graph BT;
	MovingEvent;
	GetDataWin;
	PortManagerWin;   
	ResultsWin;
```

### Backend

```mermaid
graph BT;
    Ship-->ScheduleItem;
    Manager;
    Event;
```
## Текстовые спецификации основных классов системы

## Frontend

### ShipInput
Обертка над четырьмя_ kat::TextInput*_ для удобного размещения этих объектов в _kat::VerScrollArea_. Унаследован от _kat::TextInput_ для того, чтобы дергать ф-ии полей класса из переопределенных методов базового
Содержит поля ввода для:
+ Имя корабля
+ Тип груза корабля
+ Вес груза
+ Время планируемого прибытия
### GetDataWin
Окно ввода дынных:
+ Разброс случайных величин
+ Количество кранов каждого типа
+ Количество и данные по кораблям
### DrawableScheduleItem
Класс для отображаемого содержания. Является оберткой над _kat::Button*_ (для центрирования текста), унаследован от _kat::Div_, для возможности отображаться на экране.
Содержит:
+ Флаг разгружен/не разгружен
+ Имя корабля
+ Тип груза корабля
+ Вес груза
+ Время планируемого прибытия
+ Предполагаемое время разгузки
### ScheduleScroll
Вынесен в отдельный класс чтобы добавить ф-ию _changeUnload(size_t)_ - по индексу меняет значение unload в i-ом _DrawableScheduleItem_ 

### MovingEvent
Событие перемещения из точки A в точку B в момент времени с _start_time_ по _end_time_. Поле _is_y_first_, отвечает за то, по какой координате начнется перемещение
+ Ф-ия _getCoorInTime(int64_t)_ возвращает координаты корабля в момент time(параметр), вернет {-1e5, -1e5}, если во время time перемещение еще не началось, и {1e5, 1e5}, если уже закончилось
+ Ф-ия _getEndPos()_ возвращает координаты в момент времени _end_time_. 
### DrawableShip
Отображаемый корабль. Наследован от _kat::Image_ для вывода на экран изображение. В конструкторе рандомно выбирает sprite корабля в зависимости от типа груза. Содержит _std::vector_ _MovingEvent_. С помощью ф-ии _updCoorInTime(int64_t time)_ рассчитывается позиция исходя из текущего времени (параметр) и данных из _MovingEvent_

### PortManagerWin
Основной класс интерфейса. Содержит поля, необходимые для отображения и объект класса _Manager_, а также следующие ф-ии:
#### modeling()
Ф-ия отрисовки. Так же обрабатывает все события пользователя: нажатие кнопки мыши, перемещение курсора и т.д.
#### forwardEvents()
Последовательно обрабатывает события из объекта класса _Manager_, для которых время меньше или равно текущему времени в моделировании. 
#### convertEventToShip(const Event& event)
Переводит объект типа event в объекты типа _DrawableShip_ и _MovingEvent_. 
#### backwardEvent()
Откатывает события из объекта класса _Manager_, пока время события больше, чем текущее временя в моделировании.
#### rollbackEvent(const Event& event) 
Выполняет ту же функцию, что и _convertEventToShip_, но в обратную сторону по линии времени, те откатывает изменения, сделаные в convertEventToShip

## Backend

### ScheduleItem
Хранит информацию про запланированный приезд кораблей (расписание).
#### Поля:
* *type_* - тип груза
* *name_* - имя корабля
* *weight_* - вес груза
* *unload_time_* - время разгрузки
* *arrival_* - время прибытия в порт
#### Методы:
*Getters* для всех полей
### Ship
Унаследован от ScheduleItem. Хранит всю информацию про корабль, необходимую для моделирования.
#### Поля:
* Поля класса ScheduleItem
* *fee_* - штраф корабля
* *start_of_unloading_* - время начала разгрузки корабля
* *waiting_time_* - время ожидания в очереди
#### Методы:
* Методы класса ScheduleItem
* *operator <* - сравнивает корабли по времени прибытия
* *Getters* и *setters* для полей *fee_, start_of_unloading_, waiting_time_*
* Setters для полей *fee_, start_of_unloading_, waiting_time_*
* *addToFee* - изменение штрафа
### Event
Хранит информацию про события прибытия/отбытия/разгрузку кораблей.
#### Поля:
* *id_crane_* - индекс крана
* *time_* - время в которое происходит событие
* *type_* - тип события
* ship_ - указатель на корабль с которым происходит событие
#### Методы:
* *Getters* для всех полей класса
* *operator <*
### Manager
Обобщающий класс backend. Принимает расписание и параметры моделирования. На их основе моделирует процесс, параллельно насчитывая статистику, выводимую в конце моделирования.
#### Поля:
* *ships_* - вектор всех кораблей, участвующих в моделировании (уже с опозданиями)
* *events_* - отсортированный вектор всех событий
* *schedule_* - расписание, данное из входных данных
* *count_container_cranes_, count_granular_cranes,  count_liquid_cranes_* - количество кранов
* *delay_min_, delay_max_,  late_arrival_min_, late_arrival_max_* - ограничения на случайные величины
* *fee_, total_delay_, max_delay_, total_waiting_time_,  delay_min_, delay_max_, max_time_* - статистические данные моделирования
* *ptr_* - индекс текущего события
#### Методы:
* *Getters* для статистических данных
* *Settres* для границ случайных величин
* *Setters* для количества кранов
* *setShips* меняет вектор кораблей, добавляет случайные величины к времени прибытия и времени разгрузки
* *modeling* - моделирует процесс работы порта
* *modelingForOneType* - приватный метод, моделирует процесс для одного типа кораблей